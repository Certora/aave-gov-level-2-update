# Aave proposal to lower the long executor quorum

Repository containing the necessary contracts to propose for the lowering of the quorum and configs of the long executor, and the contracts to make the a proposal for the Aave ecosystem reserve to vote in favor of that proposal.

The new parameters of the new long executor will be:
- Quorum: from 20% to 6.5%
- Differential: from 15% to 6.5%
- Proposing power: from 2% to 1.25%

For this to go as expected, first the longExecutor proposal will need to be executed. Then with the id of that proposal (update the proposal code), the ecosystemReserve proposal will need to be executed to vote on the longExecutor one.

## Install

To install and execute the project locally, you need:

- ```npm install``` : As there are some scripts to make deployment easier.
- ```forge install``` : This project is made using [Foundry](https://book.getfoundry.sh/) so to run it you will need to install it, and then install its dependencies.


## Contracts

On the [contracts](/src/contracts) folder we can find the necessary solidity smart contracts.

- Contract Implementation Updates:
The following contracts are updates on the current deployed implementations, to add the necessary logic for the rescue. For the case of implementation updates, code differentials have been generated by pulling the currently deployed source code from [etherscan](https://etherscan.io/).

- [AaveEcosystemReserveV2](/src/contracts/AaveEcosystemReserveV2.sol): This contract has the logic to vote on a specific proposal with the ecosystem Aave token balance. This will be executed on initialize. This is done so we will be able to more easiliy pass the proposal that deploys the new long executor as that will require 20% of the token distribution, and the ecosystem reserve has 10% of it aprox.

We can also find the necessary contracts to change the long executor quorum:

- [Executor](/src/contracts/LongExecutor.sol): This contract has the same logic as the current [long executor](https://etherscan.io/address/0x61910EcD7e8e942136CE7Fe7943f956cea1CC2f7) but with a decrese on the MINIMUM_QUORUM, to make the proposals executed by the long executor not as hard to pass. It also contains methods to update the settings, so as in the future there is no need to deploy new long executors.


### Governance Payloads

For the long executor parameters to be changed we created two proposals:

- [ProposalPayloadLongExecutor](/src/contracts/ProposalPayloadLongExecutor.sol): This proposal payload will set a new executor with same settings as the current long executor, but with a lesser MINIMUM_QUORUM of 12% as the new proxy admin of all the contracts using the currently deployed [long executor](https://etherscan.io/address/0x61910EcD7e8e942136CE7Fe7943f956cea1CC2f7).
  <details>
    <summary>TODO: List of contracts that will be updated:</summary>
      - [AAVE](https://etherscan.io/address/0x7fc66500c84a76ad7e9c93437bfc5ac33e2ddae9)
      - [ABPT](https://etherscan.io/address/0x41a08648c3766f9f9d85598ff102a08f4ef84f84#code)
      - [stkAAVE](https://etherscan.io/address/0x4da27a545c0c5b758a6ba100e3a049001de870f5#code)
      - [stkABPT](https://etherscan.io/address/0xa1116930326d21fb917d5a27f1e9943a9595fb47)
  </details>
- [ProposalPayloadAaveEcosystemReserveV2](/src/contracts/ProposalPayloadAaveEcosystemReserveV2.sol): This proposal payload will deploy the new ecosystem reserve. It needs to be deployed after the ProposalPayloadLongExecutor has been created, as we need to deploy it with its ID. The ecosystem reserve proposal will make it so the ecosystem votes on the proposal id from the Long executor proposal.


### Tests

We have used foundry to create this solidity project, so to run the tests you will need to run ```forge test```. But as we are using already deployed contracts, the tests need to be run in a fork environment. For this you will need to execute this command:

```
âžœ forge test --fork-url https://rpc.flashbots.net -vvvv --fork-block-number <latest block number>
```

To test deployment you can run ```npm run deployTest:le``` and ```npm run deployTest:erV2``` which will give out possible deployed addresses and will output gas estimation. For this you will need to add these on your .env file:
```
PRIVATE_KEY= // used to deploy contracts
FORK_URL= // rpc url pointing to mainnet
```


### Deploy

To deploy the necessary contracts and proposal payloads, [deployEcosystemReserve.sol](/src/deploy/deployEcosystemReserve.sol) and [deployLongExecutor.sol](/src/deploy/deployLongExecutor.sol) solidity forge script has been created. There we make use of the [deployCode](https://book.getfoundry.sh/reference/forge-std/deployCode.html?highlight=deploycode#deploycode) forge std method to deploy the contracts that have the solidity version 0.7.5 (mainly the AaveTokenV2, StakedTokenV2Rev4 and ProposalPayloadLong) that are incompatible with the 0.8.0 version used everywhere else.

You can use the npm script:
```
npm run deploy:le
npm run deploy:erV2
```
Which will deploy everything needed for the rescue phase 1 and will try to verify with etherscan. For this remember to add:
```
ETHERSCAN_API_KEY= // used to verify contracts against etherscan
PRIVATE_KEY= // used to deploy contracts
FORK_URL= // rpc url pointing to mainnet
```
to your .env file. If you want to deploy to a test network you only need to change ```FORK_URL``` to the rpc pointing to that network.
